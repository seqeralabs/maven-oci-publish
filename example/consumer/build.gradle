plugins {
    id 'java'
    id 'application'
    id 'io.seqera.maven-oci-publish'  // For consumer support
}

group = 'io.seqera'
version = '1.0.0'

repositories {
    mavenCentral()
}

// Configure OCI repositories for dependency resolution
ociRepositories {
    seqeraPublic {
        url = 'https://public.cr.stage-seqera.io/maven'
        // Anonymous access - resolves io.seqera:shared-library:1.0.0
        // to public.cr.stage-seqera.io/maven/io-seqera/shared-library:1.0.0
    }
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

application {
    mainClass = 'io.seqera.consumer.ConsumerApp'
}

dependencies {
    // Normal Maven dependency using OCI repository!
    implementation 'io.seqera:shared-library:1.0.0'
    // This automatically resolves to public.cr.stage-seqera.io/maven/io-seqera/shared-library:1.0.0
    
    implementation 'org.slf4j:slf4j-api:2.0.7'
    implementation 'ch.qos.logback:logback-classic:1.4.7'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.9.2'
}

test {
    useJUnitPlatform()
}

// Custom task to show how to consume OCI artifacts
tasks.register('showConsumptionInfo') {
    doLast {
        println "\nðŸ“¦ Enhanced OCI Artifact Consumption:"
        println "   Registry: https://public.cr.stage-seqera.io/maven"
        println "   Maven Coordinates: io.seqera:shared-library:1.0.0"
        println "   OCI Reference: public.cr.stage-seqera.io/maven/io-seqera/shared-library:1.0.0"
        
        println "\nâœ… Current: Normal Maven Dependency (now implemented!)"
        println "   repositories {"
        println "       mavenCentral()"
        println "   }"
        println "   ociRepositories {"
        println "       seqeraPublic {"
        println "           url = 'https://public.cr.stage-seqera.io/maven'"
        println "       }"
        println "   }"
        println "   dependencies {"
        println "       implementation 'io.seqera:shared-library:1.0.0'"
        println "   }"
        
        println "\nðŸ”§ Enhanced Coordinate System Features:"
        println "   âœ… Predictable Maven â†’ OCI mapping"
        println "   âœ… Hierarchical organization (group/artifact structure)"
        println "   âœ… Docker-compatible naming (dots â†’ hyphens)"
        println "   âœ… Namespace isolation"
        println "   âœ… Anonymous access support"
        println "   âœ… Native Gradle dependency resolution"
    }
}

